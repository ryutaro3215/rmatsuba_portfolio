---
title: "Session, Cookie, JWTって何？"
emoji: "🪟"
date: "2026-01-29"
created_at: "2026-01-29T11:35:03.629Z"
updated_at: "2026-01-31T09:58:38.547Z"
draft: true
slug: "what-is-session-cookie-jwt"
tags: []
---

## Session, Cookie, JWTって何？

### Sessionとは

大前提としてアプリケーションへのユーザーアクセスにおいては**認証と認可**二つのレイヤーがある。

本来はHTTP通信というのはステートレスな通信だが、それをステートフルなものにするための技術。クライアントからのアクセスを識別することで、クライアント＝サーバー間での通信情報を保つために使う。

Sessionという名前がわかりにくいのは、Sessionという一つの単語に複数の意味が暗黙的に含意されているから。

そこで

1. 概念として
2. 実装として
3. データとして
   の側面がある。

概念としてのセッションというのは「通信の論理的な開始から終了まで」という意味であり、具体的にはログインからログアウトまで、ECサイトにおけるカートへの商品投入から購入までなどがある。実装としてセッションというのは、httpの通信をsessionを用いて実装するなどという言い方をする。

では実装としてのセッションというのがなんなのか？ということを考えるにあたって必要なのが、データとしてのセッションである。データとしてのセッションというときに出てくるのがsessionIDとsession storeである。これらはいずれもserver側で管理される。次回以降クライアントからのリクエストにあるsessionIDを確認することで通信を判別する

#### セッションのメリット

##### 直接的な改ざんが難しい

クッキーに「userID=1000」のようにIDを直書きしていると書き換えられてしまうかもしれませんが、セッションIDだけなら意味がありませんね(ただのランダム文字列なので)。

たとえユーザーが勝手にクッキーのセッションIDを書き換えても、サーバー側のセッションストアと紐付かない限り正しいデータは得られません。

##### 機密情報を安全に管理できる

クッキーでやりとりされるのは「セッションID」のみなので、パスワードなど、直接的に見られたくないデータはすべてサーバー側で管理できます。

##### ログアウトやタイムアウトを実装しやすい

「一定時間操作がなかったらセッションを破棄する」などの仕組みをサーバー側で集中管理できるため、ログアウトやセキュリティ制限を柔軟に運用できます。

#### セッションの注意点

##### セッションIDの盗難リスク

もしセッションIDそのものが漏れてしまうと、結局はそのIDでサーバーを騙すことが可能になり、なりすましされる危険があります(セッションハイジャック)。

対策としては以下のものがあります。

- HTTPS（TLS）で通信を暗号化する
- Secure フラグや HttpOnly フラグを付ける
- アクセス元IPアドレスのチェックやワンタイムトークン（CSRF対策）など、追加のセキュリティ機構を取り入れる

##### サーバー負荷・スケーリングの問題

セッションを多くのユーザーが利用すると、サーバー側でそれだけ多くのセッション情報を管理しなくてはなりません。  
サーバーの台数を増やして負荷分散する場合には「セッションの同期」をどうするかが課題になります(たとえば Redis やデータベースをセッションストアにして集中管理する、Sticky Session を使うなど)。

**sessionのイメージ**

```mermaid
graph LR
A["Client
2回目以降のアクセスではsessionIDを詰めておくことでユーザーを判別する"] -->|リクエストの送信| B["Server
sessionIDをsession Storeに保持して管理する"]
B -->|sessionIDの送信| A
```

### Cookieとは

**Cookie**（ウェブ Cookie、ブラウザー Cookie とも呼ぶ）は、サーバーがユーザーのウェブブラウザーに送信する小さなデータ。

元々は汎用的なクライアント側のデータストレージとしての用途として使われていた。（現在はストレージ用途としては大体のものが存在しているのでそちらの利用が推奨される。

しかしながら、「データを格納しておく」という機能的側面に関しては変わっていない。

Cookieの主な用途は

1. セッション管理→ログイン機能、ショッピング機能、ゲームのスコア、その他ユーザーセッションに関してサーバーが覚えておくべきもの
2. パーソナライズ→表示言語やUIテーマなどのユーザー設定
3. トラッキング→ユーザーの行動の記録や分析

Cookieはウェブ標準のセッション管理の仕組み。さらにセキュリティの機能も豊富である。ex) HttpOnly, Secure, SameSite etc...

ちなみにAPI設計などではhttp headerにJWTを付与して通信する方法もあるため、一概にCookieだけを使うのがベストプラクティスではない。

Cookieはブラウザ側での管理が基本。というのもこのクッキーの情報はlocalに保存しておいて、同じドメインへのリクエスト時に該当するCookieをブラウザが自動で送信する。

あくまでクッキーというのはそこに保存されている情報の正当性に関しては関与しないため、仮に効力が切れているsessionIDなどを持っていたとしてもそれをサーバーに送る。そのデータが効力を持つかどうかはサーバー側で管理する

### SessionとCookieの関係性

SessionとCookieを使い合わせることで、セキュアで楽にステートフルな通信を実装できる。技術的にはsessionIDをそのままhttp headerにつめても通信は可能。cookieを使うのは、サーバーが発行したCookieを受け取ったブラウザは次回リクエスト以降、自動でcookieをリクエストに付与してくれるからいちいちsessionIDをheaderに付与しなくてよくなる

またsessionを使わずにcookieに直接userIDなどを持たせるのももちろん危険なのでNG。sessionIDというのはクライアントを問わない、というよりもサーバー側で発行するランダムなtokenなのでclientに依存しない。

### JWT (JSON Web Token)

Sessionがsessionベースを用いた認証であるのに対して、JWTはtokenベース認証。基本的な仕組みはsessionと変わらず、クライアントがサーバーに最初にアクセスしたときにjwtを発行してcookieに含めてクライアントに返す。

その後クライアントはアクセス時にjwtを詰めてアクセスする。

違ってくるのはサーバー側での挙動で、sessionはsession storeにsessionに関する情報をとっておいて、クライアントからのsessionIDと照らし合わせることで認証を可能にしている。

一方でjwtではクライアントからjwtを受け取るたびにそのjwtが正しいものかどうかを判断する（でコードして）ことで認証を可能にしている。

つまりサーバー側では特に通信のデータを保存しておらず、通信のたびにjwtを解析して通信の正当性を確認する。

```
jwtの具体例
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

#### jwtの構造

jwtは.（ドット）で区切られており、三つのパーツで構成されている。

1. ヘッダ
2. ペイロード
3. 署名

これらの部分をそれぞれデコードするとjsonデータになり扱えるようになる。

jwtは誰でももとに戻してデータにすることができるが、署名部分があるため改ざんの検知も可能になっている。

#### jwt認証のメリット

- サーバーが情報を持たない（session情報のように）ためスケーラビリティがある
- 軽量→jsonなのでどこでも扱える
- 汎用的→API間でのデータ共有や分散システムでも可能

ただし、ペイロード部分は暗号化されないので中身を見られても問題ないものだけを含める必要がある。

### 参考資料

[セッションの仕組みをCookie抜きで理解する](https://qiita.com/fujishiro380/items/d29bc37c9faa4fc818c2)
[Session Management Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#session-id-properties)
[CookieとSessionとJWTは何が違う？](https://zenn.dev/daichi09167/articles/aead557a113516)
[CookieとSessionを雰囲気で使っているエンジニアが、違いを説明できるようにする記事](https://zenn.dev/collabostyle/articles/8949e8db686263)
[JWTを用いた認証の仕組み](https://zenn.dev/collabostyle/articles/b08c7f29a2e94c#jwt%E8%AA%8D%E8%A8%BC%E3%81%A8%E3%81%AF%EF%BC%9F)
